<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
</body>
<script>
    // æ ¸å¿ƒæ•°æ®å“åº”å¼æ–¹æ³•
    function defineReactive(obj, key, val) {
        // valå¯èƒ½è¿˜æ˜¯ä¸ªå¯¹è±¡ï¼Œéœ€è¦é€’å½’ä¸€ä¸‹,æ·±åº¦ç›‘å¬
        observer(val);

        Object.defineProperty(obj, key, {
            get() {
                return val
            },
            set(newVal) {
                if (newVal !== val) {
                    val = newVal;

                    // å¦‚æœæ”¹å˜çš„æ˜¯ä¸ªå¯¹è±¡ï¼Œè¿˜éœ€è¦è°ƒç”¨ä¸€ä¸‹,æ·±åº¦ç›‘å¬
                    observer(newVal);

                    console.log('è§†å›¾æ›´æ–°äº†', newVal);
                    // åœ¨è¿™é‡Œå·²ç»ç›‘å¬åˆ°äº†æ•°æ®çš„å˜åŒ–ï¼Œåç»­å¯ä»¥åšä¸€äº›æ›´æ–°è§†å›¾çš„æ“ä½œ
                }
            }
        })
    }

    // å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå±æ€§ï¼Œå¾ªç¯è°ƒç”¨defineReactiveï¼Œä¼ å…¥æ¯ä¸€ä¸ªå€¼å»è¿›è¡Œç›‘å¬
    function observer(obj) {
        // åˆ¤æ–­objæ˜¯å¦æ˜¯æ•°ç»„
        if (Object.prototype.toString.call(obj) !== "[object Object]") {
            return
        }
        Object.keys(obj).forEach(key => defineReactive(obj, key, obj[key]))
    }

    // å¦‚æœç»™å¯¹è±¡å¢åŠ æ–°çš„å±æ€§ï¼Œæ˜¯ç›‘å¬ä¸åˆ°å˜åŒ–çš„ï¼Œé‚£ä¹ˆéœ€è¦ç”¨setæ–¹æ³•ä¼ å…¥æ–°å¯¹è±¡ï¼Œè°ƒç”¨defineReactiveæ‰‹åŠ¨ç›‘å¬ä¸€ä¸‹
    function set(obj, key, val) {
        defineReactive(obj, key, val);
    }

    //å‡†å¤‡æ•°æ®æº
    const data = {
        name: 'æ¢æ†¨æ†¨',
        age: '20',
        info: {
            address: 'åŒ—äº¬'
        },
        nums: ["ğŸ", "ğŸ¥", "â˜€", "ğŸ¦†"]
    }
    console.log(data);
    observer(data);

    //æµ‹è¯•
    data.name = 'æ¢èœé¸¡';
    data.age = 50;
    data.info.address = 'æ·±åœ³';
    data.nums.push("ğŸ‡")
    set(data, "look", 'æœ‰é£ç¢Ÿ');

    console.log(data);
</script>

</html>